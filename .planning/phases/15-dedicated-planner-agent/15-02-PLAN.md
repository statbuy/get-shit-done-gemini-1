---
phase: 15-dedicated-planner-agent
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified: [commands/gsd/plan-phase.md, get-shit-done/workflows/plan-phase.md, get-shit-done/templates/planner-subagent-prompt.md]
autonomous: true

must_haves:
  truths:
    - "/gsd:plan-phase command spawns gsd-planner agent"
    - "Orchestrator is thin (<200 lines)"
    - "Template provides context, agent has expertise"
  artifacts:
    - path: "commands/gsd/plan-phase.md"
      provides: "Thin orchestrator for phase planning"
      min_lines: 80
      contains: "agent: gsd-planner"
    - path: "get-shit-done/templates/planner-subagent-prompt.md"
      provides: "Context-only prompt template for spawning planner"
      min_lines: 50
  key_links:
    - from: "commands/gsd/plan-phase.md"
      to: "agents/gsd-planner.md"
      via: "agent: gsd-planner frontmatter"
      pattern: "agent: gsd-planner"
---

<objective>
Refactor /gsd:plan-phase to thin orchestrator that spawns gsd-planner agent.

Purpose: Reduce context usage in main thread from ~3,580 lines to ~150 lines.
Output: Thin orchestrator command and context-only subagent prompt template.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Pattern references from Phase 13-14:
@commands/gsd/debug.md
@commands/gsd/research-phase.md
@get-shit-done/templates/debug-subagent-prompt.md
@get-shit-done/templates/research-subagent-prompt.md

# Prior plan summary:
@.planning/phases/15-dedicated-planner-agent/15-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor /gsd:plan-phase to thin orchestrator</name>
  <files>commands/gsd/plan-phase.md</files>
  <action>
Rewrite `commands/gsd/plan-phase.md` as thin orchestrator following debug.md and research-phase.md patterns.

**New frontmatter:**
```yaml
---
name: gsd:plan-phase
description: Create detailed execution plan for a phase (PLAN.md)
argument-hint: "[phase] [--gaps]"
context: fork
agent: gsd-planner
allowed-tools:
  - Read
  - Write
  - Bash
  - Glob
  - Grep
  - WebFetch
  - mcp__context7__*
---
```

**Key change:** Add `agent: gsd-planner` to spawn dedicated agent.

**Orchestrator responsibilities (keep in command):**
1. Check .planning/ directory exists
2. Parse arguments (phase number, --gaps flag)
3. Detect next unplanned phase if no number provided
4. Validate phase exists in roadmap
5. Gather minimal context (STATE.md, ROADMAP.md paths)
6. Spawn gsd-planner agent with context
7. Present results and next steps

**Delegate to agent:**
- All planning methodology
- Discovery levels
- Task breakdown
- Dependency analysis
- Plan creation
- Gap closure logic

**Target:** ~120-150 lines (similar to research-phase.md at 130 lines)

**Structure:**
```markdown
<objective>
[Brief - planning phases into PLAN.md files]
</objective>

<orchestrator_process>
1. Validate .planning/ exists
2. Parse $ARGUMENTS for phase number and --gaps
3. If no phase: detect next unplanned from roadmap
4. Validate phase in roadmap
5. Spawn gsd-planner with context
6. Present results
</orchestrator_process>

<spawn_planner>
Use Task tool to spawn gsd-planner agent with:
- Phase number
- Gap closure mode flag
- Project context paths
</spawn_planner>

<present_results>
[Format for showing plan summary and next steps]
</present_results>
```

**DO NOT include in orchestrator:**
- Plan-phase workflow content
- Reference file content
- Task breakdown logic
- Discovery level definitions
- Scope estimation rules
  </action>
  <verify>
File exists: `commands/gsd/plan-phase.md`
Has `agent: gsd-planner` in frontmatter
Line count under 200
No workflow or reference file inclusions in execution_context
  </verify>
  <done>/gsd:plan-phase refactored to thin orchestrator (~120-150 lines)</done>
</task>

<task type="auto">
  <name>Task 2: Deprecate workflows/plan-phase.md</name>
  <files>get-shit-done/workflows/plan-phase.md</files>
  <action>
Replace `get-shit-done/workflows/plan-phase.md` with deprecation notice following the pattern from workflows/debug.md and workflows/research-phase.md.

**New content:**
```markdown
# DEPRECATED: Plan-Phase Workflow

**This workflow has been consolidated into the gsd-planner agent.**

## Migration

Planning expertise is now baked into:
- `agents/gsd-planner.md` - Complete planning methodology

The `/gsd:plan-phase` command spawns the gsd-planner agent directly.

## Why This Changed

The thin orchestrator pattern reduces main context usage:
- Before: ~3,580 lines loaded into main context
- After: ~150 lines in orchestrator, expertise in agent

## Historical Reference

This file previously contained:
- Discovery level definitions
- Project history assembly
- Task breakdown process
- Dependency graph building
- Wave assignment algorithm
- Plan writing steps

All content preserved in `agents/gsd-planner.md`.

---
*Deprecated: 2026-01-16*
*Replaced by: agents/gsd-planner.md*
```

**Keep file for git history** - do not delete.
  </action>
  <verify>
File exists with deprecation notice
Points to agents/gsd-planner.md
Explains why change was made
  </verify>
  <done>workflows/plan-phase.md deprecated with redirect to agent</done>
</task>

<task type="auto">
  <name>Task 3: Create planner-subagent-prompt.md template</name>
  <files>get-shit-done/templates/planner-subagent-prompt.md</files>
  <action>
Create `get-shit-done/templates/planner-subagent-prompt.md` following the pattern from debug-subagent-prompt.md and research-subagent-prompt.md.

**Template structure:**
```markdown
# Planner Subagent Prompt

Context-only template for spawning gsd-planner agent. Agent has all methodology baked in.

## Template

\`\`\`markdown
<planning_context>

**Phase:** {phase_number}
**Mode:** {standard | gap_closure}

**Project State:**
@.planning/STATE.md

**Roadmap:**
@.planning/ROADMAP.md

**Requirements (if exists):**
@.planning/REQUIREMENTS.md

**Phase Context (if exists):**
@.planning/phases/{phase_dir}/{phase}-CONTEXT.md

**Research (if exists):**
@.planning/phases/{phase_dir}/{phase}-RESEARCH.md

**Gap Closure (if --gaps mode):**
@.planning/phases/{phase_dir}/{phase}-VERIFICATION.md
@.planning/phases/{phase_dir}/{phase}-UAT.md

</planning_context>

<downstream_consumer>
Output consumed by /gsd:execute-phase or /gsd:execute-plan
Plans must be executable prompts with:
- Frontmatter (wave, depends_on, files_modified, autonomous)
- Tasks in XML format
- Verification criteria
- must_haves for goal-backward verification
</downstream_consumer>

<quality_gate>
Before returning PLANNING COMPLETE:
- [ ] PLAN.md files created in phase directory
- [ ] Each plan has valid frontmatter
- [ ] Tasks are specific and actionable
- [ ] Dependencies correctly identified
- [ ] Waves assigned for parallel execution
- [ ] must_haves derived from phase goal
</quality_gate>
\`\`\`

## Usage

Orchestrator fills in context paths and spawns agent:
1. Replace {phase_number} with actual phase
2. Replace {phase_dir} with phase directory name
3. Set mode based on --gaps flag
4. Agent loads context and produces plans
```

**Key principle:** Template provides CONTEXT. Agent has EXPERTISE.
  </action>
  <verify>
File exists: `get-shit-done/templates/planner-subagent-prompt.md`
Contains planning_context section
Contains downstream_consumer section
Contains quality_gate section
No methodology content (that's in the agent)
  </verify>
  <done>planner-subagent-prompt.md template created</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] commands/gsd/plan-phase.md is thin orchestrator (<200 lines)
- [ ] workflows/plan-phase.md has deprecation notice
- [ ] templates/planner-subagent-prompt.md created
- [ ] All three files committed
</verification>

<success_criteria>
- /gsd:plan-phase refactored to thin orchestrator
- Workflow deprecated with redirect
- Subagent template created
- Pattern matches Phase 13-14 (debug, research)
</success_criteria>

<output>
After completion, create `.planning/phases/15-dedicated-planner-agent/15-02-SUMMARY.md`
</output>
