---
phase: 15-dedicated-planner-agent
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [agents/gsd-planner.md]
autonomous: true

must_haves:
  truths:
    - "gsd-planner agent file contains complete planning methodology"
    - "Agent includes all concepts from source reference files"
    - "Agent follows established gsd-debugger/gsd-researcher patterns"
  artifacts:
    - path: "agents/gsd-planner.md"
      provides: "Complete planning agent with baked-in expertise"
      min_lines: 800
      contains: "name: gsd-planner"
  key_links:
    - from: "agents/gsd-planner.md"
      to: "planning methodology"
      via: "consolidated content"
      pattern: "<role>|<philosophy>|<execution_flow>"
---

<objective>
Create gsd-planner agent with complete planning methodology baked in.

Purpose: Consolidate ~3,580 lines of planning references into a dedicated agent that spawns for phase planning.
Output: `agents/gsd-planner.md` with all planning expertise (~900-1100 lines).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Pattern references from Phase 13-14:
@agents/gsd-debugger.md
@agents/gsd-researcher.md

# Source files to consolidate:
@get-shit-done/references/principles.md
@get-shit-done/workflows/plan-phase.md
@get-shit-done/templates/phase-prompt.md
@get-shit-done/references/plan-format.md
@get-shit-done/references/scope-estimation.md
@get-shit-done/references/checkpoints.md
@get-shit-done/references/tdd.md
@get-shit-done/references/goal-backward.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create gsd-planner agent file</name>
  <files>agents/gsd-planner.md</files>
  <action>
Create `agents/gsd-planner.md` consolidating all planning methodology from source files.

**Agent structure (follow gsd-debugger/gsd-researcher pattern):**

**Frontmatter:**
```yaml
---
name: gsd-planner
description: Creates executable phase plans with task breakdown, dependency analysis, and goal-backward verification. Spawned by /gsd:plan-phase orchestrator.
tools: Read, Write, Bash, Glob, Grep, WebFetch, mcp__context7__*
color: green
---
```

**Required sections:**

1. `<role>` - Planning agent identity
   - Spawned by /gsd:plan-phase orchestrator
   - Produces PLAN.md files with executable tasks
   - Handles both standard planning and gap closure mode (--gaps)

2. `<philosophy>` - Core planning principles
   - Solo developer + Claude workflow (from principles.md)
   - Plans are prompts (not documents that become prompts)
   - Scope control and quality degradation curve
   - Ship fast, no enterprise patterns

3. `<discovery_levels>` - Mandatory discovery protocol
   - Level 0-3 from plan-phase.md
   - When to research vs proceed
   - Integration with Context7 for library questions

4. `<task_breakdown>` - How to decompose phases
   - Task anatomy: files, action, verify, done
   - Task types: auto, checkpoint:human-verify, checkpoint:decision, checkpoint:human-action
   - TDD detection heuristic (from tdd.md)
   - User setup detection for external services

5. `<dependency_graph>` - Building dependency graphs
   - needs/creates analysis per task
   - Wave assignment algorithm
   - Vertical slices vs horizontal layers
   - File ownership for parallel execution

6. `<scope_estimation>` - Plan sizing
   - Context budget rules (50% target, 2-3 tasks max)
   - Split signals (always split, consider splitting)
   - Depth calibration (quick/standard/comprehensive)
   - Estimating context per task type

7. `<plan_format>` - PLAN.md structure
   - Frontmatter fields (phase, plan, type, wave, depends_on, files_modified, autonomous, must_haves)
   - XML task structure
   - Context section rules (parallel-aware)
   - Verification and success criteria

8. `<goal_backward>` - Must-haves derivation
   - Truths (observable behaviors)
   - Artifacts (files that must exist)
   - Key links (critical connections)
   - From goal-backward.md

9. `<checkpoints>` - Checkpoint patterns
   - Types and when to use each
   - Execution protocol
   - Authentication gates
   - Anti-patterns (from checkpoints.md)

10. `<tdd_integration>` - TDD plan structure
    - When TDD improves quality
    - TDD plan format vs standard plan
    - RED-GREEN-REFACTOR cycle
    - From tdd.md

11. `<gap_closure_mode>` - Planning from verification gaps
    - Parse VERIFICATION.md / UAT.md
    - Create tasks from gap.missing items
    - Number plans sequentially after existing
    - From gap_closure_mode step in plan-phase.md

12. `<execution_flow>` - Step-by-step planning process
    - load_project_state
    - load_codebase_context
    - identify_phase
    - mandatory_discovery
    - read_project_history (intelligent frontmatter assembly)
    - gather_phase_context
    - break_into_tasks
    - build_dependency_graph
    - assign_waves
    - group_into_plans
    - estimate_scope
    - confirm_breakdown
    - write_phase_prompt
    - git_commit
    - offer_next

13. `<structured_returns>` - Return format for orchestrator
    - PLANNING COMPLETE (plans created, wave structure)
    - CHECKPOINT REACHED (decision needed)
    - Planning outcome summary

14. `<success_criteria>` - Completion checklist
    - Standard mode criteria
    - Gap closure mode criteria

**Consolidation targets:**
- Preserve ALL critical concepts from source files
- Target ~900-1100 lines (similar to gsd-researcher at 902 lines)
- Eliminate redundancy between source files
- Keep examples concise but instructive
- Do NOT pad to hit line count - derive from actual content

**What to preserve:**
- Quality degradation curve percentages
- Wave assignment algorithm
- Task anatomy structure (files, action, verify, done)
- Checkpoint types and execution protocol
- Discovery levels and triggers
- Goal-backward derivation process
- TDD heuristic (can you write expect before fn?)
- Anti-patterns and bad examples
- Context budget rules

**What to compress/eliminate:**
- Duplicate explanations across files
- Verbose examples (keep one good example per concept)
- Excessive caveats and disclaimers
- Repetitive anti-pattern lists
  </action>
  <verify>
File exists: `agents/gsd-planner.md`
Contains frontmatter with `name: gsd-planner`
Has all 14 required sections with XML tags
Line count between 800-1200
  </verify>
  <done>gsd-planner agent file created with all planning methodology consolidated</done>
</task>

<task type="auto">
  <name>Task 2: Verify agent completeness</name>
  <files>agents/gsd-planner.md</files>
  <action>
Read the created agent file and verify all required content is present:

**Verification checklist:**
- [ ] Role section explains what agent does and who spawns it
- [ ] Philosophy includes solo-dev principles and "plans are prompts"
- [ ] Discovery levels include all 4 levels (0-3) with triggers
- [ ] Task breakdown includes all task types and TDD detection
- [ ] Dependency graph includes wave algorithm and vertical slices
- [ ] Scope estimation includes context budget rules and split signals
- [ ] Plan format includes complete frontmatter schema and must_haves
- [ ] Goal backward includes truths, artifacts, key_links derivation
- [ ] Checkpoints includes all types with execution protocol
- [ ] TDD integration includes when-to-use and plan structure
- [ ] Gap closure mode includes parsing and task creation
- [ ] Execution flow includes all steps from plan-phase.md
- [ ] Structured returns includes planning outcome format
- [ ] Success criteria includes both standard and gap closure checklists

**Content verification:**
- Quality degradation curve (0-30% peak, 30-50% good, 50-70% degrading, 70%+ poor)
- Wave assignment algorithm present
- Checkpoint types: human-verify, decision, human-action
- Discovery triggers for each level
- TDD heuristic about expect() before fn
- Anti-patterns section present

If any gaps found, edit file to add missing content.
  </action>
  <verify>All 14 sections present with appropriate content depth</verify>
  <done>Agent verified complete with all planning methodology</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `agents/gsd-planner.md` exists
- [ ] File has valid YAML frontmatter
- [ ] All 14 sections present with XML tags
- [ ] Line count is 800-1200 lines
- [ ] No duplicate content from compression
</verification>

<success_criteria>
- gsd-planner agent file created
- All planning methodology consolidated from source files
- Follows gsd-debugger/gsd-researcher pattern
- Ready for orchestrator integration in Plan 15-02
</success_criteria>

<output>
After completion, create `.planning/phases/15-dedicated-planner-agent/15-01-SUMMARY.md`
</output>
