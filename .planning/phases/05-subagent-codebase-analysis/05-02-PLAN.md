---
id: 05-02
name: Delegated Entity Generation
wave: 2
depends_on: [05-01]
files_modified:
  - agents/indexer.js
  - lib/intel/analyzer.js
  - lib/intel/graph.js
autonomous: true
---

# Plan 05-02: Delegated Entity Generation

## Goal
Move the heavy lifting of file parsing and entity generation into the subagent to free up the main process event loop and memory.

## Context
Currently, entity generation happens in-process (or is a placeholder). We will move this logic to `agents/indexer.js`, utilizing the infrastructure built in Plan 05-01.

## Tasks

<task type="file_create" path="lib/intel/analyzer.js">
<description>
Decouple analysis logic so it can be imported by the subagent.
</description>
<requirements>
1.  Ensure `generateEntities(source, filePath)` is pure and standalone.
2.  Implement basic regex/AST parsing for JS/TS:
    - Extract `class`, `function` definitions.
    - Extract `import`, `require` dependencies.
</requirements>
</task>

<task type="edit" path="agents/indexer.js">
<description>
Implement the real indexing logic.
</description>
<requirements>
1.  Accept list of files to scan via args or a temporary manifest file.
2.  Iterate files:
    - Read content.
    - Call `generateEntities`.
    - Upsert nodes/edges into the `db` instance.
    - Log progress via `subagent-guest`.
</requirements>
</task>

## Verification
- [ ] Run `node agents/indexer.js` manually against a set of files and verify `graph.db` updates.
- [ ] Entities (Classes, Functions) correctly extracted and stored.

## Must Haves
- Correct extraction of entities and edges.
- Scalable processing (loop over files).
