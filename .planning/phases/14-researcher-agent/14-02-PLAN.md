---
phase: 14-researcher-agent
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified: [commands/gsd/research-phase.md, get-shit-done/templates/research-subagent-prompt.md]
autonomous: true

must_haves:
  truths:
    - "/gsd:research-phase spawns gsd-researcher agent"
    - "Agent receives phase context and produces RESEARCH.md"
    - "Command is thin orchestrator (<200 lines)"
  artifacts:
    - path: "commands/gsd/research-phase.md"
      provides: "Thin orchestrator for phase research"
      min_lines: 80
      contains: "gsd-researcher"
    - path: "get-shit-done/templates/research-subagent-prompt.md"
      provides: "Subagent prompt template"
      min_lines: 30
  key_links:
    - from: "research-phase.md command"
      to: "gsd-researcher agent"
      via: "Task tool spawn"
      pattern: "subagent_type.*gsd-researcher"
---

<objective>
Refactor /gsd:research-phase to thin orchestrator that spawns gsd-researcher agent.

Purpose: Reduce main context load from ~500+ lines (command + workflow) to ~150 lines. Agent carries the research expertise.
Output: Thin orchestrator command + subagent prompt template.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Current implementation to refactor:
@commands/gsd/research-phase.md
@get-shit-done/workflows/research-phase.md

# Agent we're delegating to:
@agents/gsd-researcher.md

# Pattern to follow (from Phase 13):
@commands/gsd/debug.md
@get-shit-done/templates/debug-subagent-prompt.md

# Prior summary for context:
@.planning/phases/14-researcher-agent/14-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create research-subagent-prompt template</name>
  <files>get-shit-done/templates/research-subagent-prompt.md</files>
  <action>
Create `get-shit-done/templates/research-subagent-prompt.md` following the debug-subagent-prompt.md pattern.

**Template structure:**
```markdown
# Research Agent Prompt

You are a GSD researcher spawned by the orchestrator.

**Your agent expertise:**
@~/.claude/agents/gsd-researcher.md

**Research context:**
{PHASE_CONTEXT}

**Research mode:** {MODE}

**Research scope:**
{SCOPE}

**Output location:** {OUTPUT_PATH}

Execute research following your baked-in methodology. Return structured result when complete.
```

The template should be context-only (~50-80 lines). The agent file has all the methodology.
  </action>
  <verify>File exists at get-shit-done/templates/research-subagent-prompt.md</verify>
  <done>Subagent prompt template created, references gsd-researcher agent</done>
</task>

<task type="auto">
  <name>Task 2: Refactor research-phase command to thin orchestrator</name>
  <files>commands/gsd/research-phase.md</files>
  <action>
Rewrite `commands/gsd/research-phase.md` as a thin orchestrator (~120-150 lines).

**Orchestrator responsibilities (keep in command):**
1. Validate phase argument
2. Check for existing RESEARCH.md (offer to update/skip)
3. Load phase context (ROADMAP, requirements, CONTEXT.md if exists)
4. Spawn gsd-researcher agent with mode and context
5. Handle agent return (RESEARCH COMPLETE or RESEARCH INCONCLUSIVE)
6. Commit RESEARCH.md to git
7. Offer next steps

**Delegate to agent (via gsd-researcher):**
- Research methodology
- Source hierarchy (Context7 > official > WebSearch)
- Domain identification
- Research execution
- Verification checklist
- RESEARCH.md content creation

**Command structure:**

```yaml
---
name: gsd:research-phase
description: Research how to implement a phase before planning
argument-hint: "[phase]"
allowed-tools:
  - Read
  - Bash
  - Glob
  - Grep
  - Write
  - Task
---
```

**Process:**
1. validate_phase - Check phase exists in roadmap
2. check_existing - Offer to update/view/skip if RESEARCH.md exists
3. load_context - Read ROADMAP, requirements, CONTEXT.md
4. spawn_researcher - Use Task tool with subagent_type: "gsd-researcher"
5. handle_result - Process agent return
6. git_commit - Commit RESEARCH.md
7. offer_next - Suggest /gsd:plan-phase

**Key change:** Remove all research methodology from command. Keep only orchestration logic.
  </action>
  <verify>
- Command file is 120-150 lines
- Spawns gsd-researcher agent
- No research methodology in command (delegated to agent)
- Has validate, check_existing, load_context, spawn_researcher, handle_result, git_commit steps
  </verify>
  <done>/gsd:research-phase refactored to thin orchestrator that spawns gsd-researcher</done>
</task>

<task type="auto">
  <name>Task 3: Deprecate workflows/research-phase.md</name>
  <files>get-shit-done/workflows/research-phase.md</files>
  <action>
Replace `get-shit-done/workflows/research-phase.md` with deprecation notice (following Phase 13 pattern).

**Content:**
```markdown
# DEPRECATED

This workflow has been replaced by the gsd-researcher agent.

**New location:** `~/.claude/agents/gsd-researcher.md`

The `/gsd:research-phase` command now spawns the gsd-researcher agent directly. All research methodology is baked into the agent.

**Migration:** No action needed. Commands automatically use the new agent.
```

Keep the file (don't delete) for git history traceability.
  </action>
  <verify>File contains deprecation notice pointing to gsd-researcher agent</verify>
  <done>workflows/research-phase.md deprecated with redirect to agent</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] get-shit-done/templates/research-subagent-prompt.md exists
- [ ] commands/gsd/research-phase.md refactored (120-150 lines)
- [ ] Command spawns gsd-researcher agent
- [ ] No research methodology in command
- [ ] workflows/research-phase.md deprecated with redirect
</verification>

<success_criteria>

- /gsd:research-phase is now a thin orchestrator
- Command spawns gsd-researcher agent for research
- Main context load reduced from ~500+ to ~150 lines
- Workflow file deprecated (not deleted) with agent pointer
- Pattern established for research-project refactoring
</success_criteria>

<output>
After completion, create `.planning/phases/14-researcher-agent/14-02-SUMMARY.md`
</output>
