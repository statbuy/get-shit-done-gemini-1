---
phase: 02-massive-context-intelligence
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - hooks/gsd-intel-index.js
autonomous: true
user_setup: []
must_haves:
  truths:
    - "Semantic purpose is generated without syntax errors"
    - "Debounce logic prevents thrashing"
    - "Graph schema supports purpose storage"
  artifacts:
    - path: "hooks/gsd-intel-index.js"
      provides: "Indexing logic"
  key_links: []
---

<objective>
Polish the Intelligence Indexing Hook (`gsd-intel-index.js`) to ensure robust "Semantic Purpose" generation. Fix detected syntax errors and ensure performance via debouncing.

Purpose: Fulfill INTEL-03 requirement and ensure system stability.
Output: specific fixes in `hooks/gsd-intel-index.js`.
</objective>

<execution_context>
@~/.gemini/get-shit-done/workflows/execute-plan.md
@~/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-massive-context-intelligence/02-RESEARCH.md
@hooks/gsd-intel-index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Syntax and Logic in Indexer</name>
  <files>hooks/gsd-intel-index.js</files>
  <action>
    Edit `hooks/gsd-intel-index.js`:
    1. Fix the `const cmd = .gemini ...` syntax error (likely missing backticks).
    2. Ensure `generateEntity` properly calls the Gemini CLI.
    3. Verify `syncEntityToGraph` correctly reads the markdown and updates the DB.
  </action>
  <verify>
    Run `node hooks/gsd-intel-index.js` (it expects stdin, so pipe empty JSON `echo '{}' | node ...`).
    Ensure no syntax error crash.
  </verify>
  <done>File parses and runs without error.</done>
</task>

<task type="auto">
  <name>Task 2: Add Debounce to Watcher Integration</name>
  <files>bin/gsd-watch.js</files>
  <action>
    Check `bin/gsd-watch.js` (the caller).
    Ensure it uses `debounce` when calling the hook, or add debounce logic inside the hook if appropriate (though hook is usually one-off process).
    
    Actually, the RESEARCH says: "Use `debounce` for batching indexing tasks... do not invent complex timing logic."
    
    If `gsd-watch.js` calls the hook, `gsd-watch.js` should handle the debouncing.
    
    Action:
    - Read `bin/gsd-watch.js`.
    - If missing debounce, add it.
    - If present, verify it matches the research recommendation.
  </action>
  <verify>
    Review `bin/gsd-watch.js` code.
  </verify>
  <done>Debounce logic confirmed.</done>
</task>

</tasks>

<verification>
- [ ] Syntax error fixed.
- [ ] Debounce logic confirmed/added.
</verification>

<success_criteria>
- Indexing system is stable and performant.
</success_criteria>

<output>
After completion, create `.planning/phases/02-massive-context-intelligence/02-03-SUMMARY.md`
</output>
